var hasClass = function (element, className) {
	return new RegExp(' ' + className + ' ').test(' ' + element.className + ' ');
},	
removeClass = function (element, removeClass) {
	var regex = new RegExp('(?:^|\\s)' + removeClass + '(?!\\S)');
	element.className = element.className.replace(regex, '' );
};

document.addEventListener('DOMContentLoaded', function() {
	var btns = document.querySelectorAll('.btn'),
	addFocus = function(btn) { btn.className += ' focus'; },
	removeFocus = function(btn) { removeClass(btn, 'focus'); },
	isPage = function(page) { return window.location.href.indexOf(page) > -1; };

	for (var i = btns.length - 1; i >= 0; i--) {
		// I guess this kind of for-loop is faster
		// And I don't really need to use the iterator so why not?
		btns[i].addEventListener('mousedown', function() { addFocus(this); }, false);
		btns[i].addEventListener('mouseup', function() { removeFocus(this); }, false);
		btns[i].addEventListener('mouseout', function() { removeFocus(this); }, false);
	};

	if (isPage('stock')) ;
	else if (isPage('profile')) profilePage();
	else indexPage();
});

// @prepros-append index.js
var indexPage = function() {
	var signingBox = document.querySelector('#js-signing-box'),
		confirmPassword = document.querySelector('#js-confirm-password'),
		signUp = document.querySelector('#js-sign-up'),
		inputs = document.querySelectorAll('.fancy-input'),

	signUpClicked = function(btn) {
		if (!signUp.hasAttribute('data-clicked')) {
			signUp.setAttribute('data-clicked', 0);
			signingBox.className += ' signup';
			signUp.value = 'Cancel';
			removeClass(confirmPassword, 'hide');
		} else {
			signUp.removeAttribute('data-clicked');
			removeClass(signingBox, 'signup');
			signUp.value = 'Sign Up';
			confirmPassword.className += ' hide';
		}
	},

	isPossibleEmail = function(email) {
		var noSpaces = email.indexOf(" ");
		var atSign = email.indexOf("@");
		var dotExists;
		if (atSign > -1 && noSpaces === -1) {
			dotExists = email.substring(atSign).indexOf(".");
			if (dotExists > -1) {
				return true;
			}
		}
		return false;
	},

	passwordsMatch = function() {
		return document.querySelector('.fancy-input:nth-child(2) input').value === document.querySelector('.fancy-input:nth-child(3) input').value;
	},

	checkPlaceholder = function(input) {
		if(input.querySelector('input').value !== '') {
			if ((input.querySelector('label').getAttribute('data-innerHTML') === 'Email' && isPossibleEmail(input.querySelector('input').value) === true) ||
				(input.querySelector('label').getAttribute('data-innerHTML') === 'Password' && input.querySelector('input').value.length > 3) ||
				(input.querySelector('label').getAttribute('data-innerHTML') === 'Confirm Password' && passwordsMatch()))  {
				input.querySelector('label').innerHTML = '';
				input.querySelector('label.error').style.opacity = 0;
			} else {
				input.querySelector('label').innerHTML = '';
				input.querySelector('label.error').style.opacity = 1;
			}
		} else {
			input.querySelector('label').innerHTML = input.querySelector('label').getAttribute('data-innerHTML');
			input.querySelector('label.error').style.opacity = 0;
		}
	};

	for(var i = 0; i < inputs.length; i++) {
		inputs[i].addEventListener('change', function() { checkPlaceholder(this); }, false);
	}
	signUp.addEventListener('click', function() { signUpClicked(this); }, false);
};
var profilePage = function() {
	var removeBtns = document.querySelectorAll('.stocksTable-remove');

	for (var i = 2; i < removeBtns.length; i++) {
		removeBtns[i].addEventListener('click', function() {
			this.parentNode.parentNode.deleteRow(i-3);
			// -1 because 0 indexed, -2 to compensate for tbody and tfoot
		}, false);
	};
};